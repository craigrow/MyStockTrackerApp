{% extends "base.html" %}

{% block title %}Import CSV - MyStockTracker{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Import Transactions from CSV</h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="portfolio_id" class="form-label">Portfolio</label>
                            <select class="form-select" id="portfolio_id" name="portfolio_id" required>
                                <option value="">Select Portfolio</option>
                                {% for portfolio in portfolios %}
                                    <option value="{{ portfolio.id }}" {{ 'selected' if portfolio.id == current_portfolio_id else '' }}>
                                        {{ portfolio.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="csv_file" class="form-label">CSV File</label>
                            <input type="file" class="form-control" id="csv_file" name="csv_file" accept=".csv" required>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle"></i> CSV Format Requirements:</h6>
                        <p class="mb-2">Your CSV file should contain the following columns:</p>
                        <ul class="mb-2">
                            <li><strong>Ticker</strong> - Stock symbol (e.g., AAPL, MSFT)</li>
                            <li><strong>Date</strong> - Transaction date (YYYY-MM-DD format)</li>
                            <li><strong>Type</strong> - Transaction type (BUY or SELL)</li>
                            <li><strong>Shares</strong> - Number of shares</li>
                            <li><strong>Price</strong> - Price per share</li>
                        </ul>
                        <p class="mb-0"><strong>Example:</strong> Ticker,Date,Type,Shares,Price</p>
                        <code>AAPL,2024-01-15,BUY,10,150.25</code>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary me-md-2">Cancel</a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload me-2"></i>Import Transactions
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        {% if preview_data %}
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Preview - First 5 Rows</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Ticker</th>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Shares</th>
                                <th>Price</th>
                                <th>Total Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in preview_data %}
                            <tr>
                                <td>{{ row.ticker }}</td>
                                <td>{{ row.date }}</td>
                                <td><span class="badge bg-{{ 'success' if row.type == 'BUY' else 'danger' }}">{{ row.type }}</span></td>
                                <td>{{ row.shares }}</td>
                                <td>${{ "%.2f"|format(row.price) }}</td>
                                <td>${{ "%.2f"|format(row.shares * row.price) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if total_rows > 5 %}
                <p class="text-muted">... and {{ total_rows - 5 }} more rows</p>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}